# **Converting Docker Compose to Kubernetes YAML - Part 2: Converting with Kompose**

## Navigation
- [Part 1: Setup & Prerequisites](#part1)
- **Part 2: Converting with Kompose** (Current)
- [Part 3: Deployment & Manual Creation](#part3)
- [Part 4: Advanced Considerations & Cleanup](#part4)

---

## **4. Converting with Kompose**

Kompose is a convenient tool that automates the translation of Docker Compose files into Kubernetes manifests. While powerful, it's essential to understand its capabilities and limitations.

### **4.1. Run Kompose Convert**

Navigate to the directory containing your **docker-compose**.yaml file and execute the kompose convert command.

| cd compose2k8kompose convert\# Explanation: This command reads your 'docker-compose.yaml' file and generates corresponding Kubernetes YAML files (Deployments, Services, PVCs, etc.) in the current directory. |
| :---- |

You might observe warnings during the conversion process, such as WARN /home/armada-user/examples/compose2k8/docker-compose.yaml: the attribute version is obsolete.... These often indicate minor syntax differences or features that Kompose handles differently.

Example output:

| WARN /home/armada-user/examples/compose2k8/docker-compose.yaml: the attribute \`version\` is obsolete, it will be ignored, please remove it to avoid potential confusionWARN File don't exist or failed to check if the directory is empty: stat :/var/lib/postgresql/data: no such file or directoryINFO Kubernetes file "app-service.yaml" createdINFO Kubernetes file "db-service.yaml" createdINFO Kubernetes file "app-deployment.yaml" createdINFO Kubernetes file "db-deployment.yaml" createdINFO Kubernetes file "postgres-data-persistentvolumeclaim.yaml" createdINFO Kubernetes file "db-cm1-configmap.yaml" created |
| :---- |

Important Note on Kompose Artifacts:

Artifacts generated by Kompose should always be verified manually before deployment. Kompose provides a good starting point, but it may not accurately generate manifests for complex deployment scenarios or capture all desired configurations.

* Limitations: Kompose might not correctly infer resource limits, advanced networking policies, specific volume types, or complex environment variable mappings (especially for secrets).
* Verification Checklist:
  * Image Names and Tags: Ensure correct image names and tags are used.
  * Ports: Verify containerPort, port, and targetPort are correctly mapped.
  * Environment Variables: Check that all necessary environment variables are present and correctly sourced (from Secrets or ConfigMaps).
  * Volume Mounts and PVCs: Confirm persistent storage is correctly configured and mounted to the appropriate paths.
  * Service Types: Adjust Service types (e.g., from ClusterIP to NodePort or LoadBalancer) based on your exposure requirements.
  * Resource Limits: Add or adjust CPU and memory requests/limits for production readiness.

### **4.2. Review Generated Manifests**

After running kompose convert, inspect the newly generated **.yaml** files in your directory. These files represent the Kubernetes translation of your Docker Compose services. You will find files like app-deployment.yaml, app-service.yaml, db-deployment.yaml, db-service.yaml, and **postgres**\-**data**\-persistentvolumeclaim.yaml.

### **4.3. Adjust Service Type for External Access**

For the **app-service**.yaml, if you intend to access your application from your local machine or browser outside the Minikube cluster, you must change its service type from ClusterIP (internal only) to NodePort.

Example app-service.yaml after modification:

| apiVersion: v1kind: Servicemetadata:  creationTimestamp: null  labels:    io.kompose.service: app  name: appspec:  ports:    \- name: "5000"      port: 5000      targetPort: 5000      nodePort: 31380 \# Example NodePort. Choose a port within the 30000-32767 range.  selector:    io.kompose.service: app  type: NodePort \# Changed from ClusterIP to NodePort to expose the service externally via the Minikube node's IP.status:  loadBalancer: {} |
| :---- |

Explanation of NodePort: A NodePort service exposes the service on a static port on each Node's IP address. You can contact the NodePort Service by requesting \<NodeIP\>:\<NodePort\>. This is commonly used in development environments like Minikube to expose services externally.

---

## Navigation
- [Part 1: Setup & Prerequisites](#part1)
- **Part 2: Converting with Kompose** (Current)
- [Part 3: Deployment & Manual Creation](#part3)
- [Part 4: Advanced Considerations & Cleanup](#part4)